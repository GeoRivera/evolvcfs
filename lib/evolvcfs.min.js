"use strict";function _toConsumableArray(d){if(Array.isArray(d)){for(var a=0,e=Array(d.length);a<d.length;a++)e[a]=d[a];return e}return Array.from(d)}(function(Global,document){var _curry=function(d){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return function(){for(var a=arguments.length,c=Array(a),f=0;f<a;f++)c[f]=arguments[f];return function(a){return a.length===d.length?d.apply(void 0,_toConsumableArray(a)):_curry(d,a)}([].concat(_toConsumableArray(b),c))}},_compose=function(){for(var d=arguments.length,a=Array(d),b=0;b<d;b++)a[b]=arguments[b];return a.reduce(function(c,a){return function(){return c(a.apply(void 0,arguments))}})},_pipe=function(){for(var d=arguments.length,a=Array(d),b=0;b<d;b++)a[b]=arguments[b];return a.reduce(function(c,a){return function(){return a(c.apply(void 0,arguments))}})},_not=function(b){return function(){return!b.apply(void 0,arguments)}},_flip=function(e){return function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return e.apply(void 0,_toConsumableArray(b.reverse()))}},_all=function(){for(var d=arguments.length,a=Array(d),b=0;b<d;b++)a[b]=arguments[b];return a.reduce(function(c,a){return!!(c&&a)},!0)},_any=function(){for(var d=arguments.length,a=Array(d),b=0;b<d;b++)a[b]=arguments[b];return a.reduce(function(c,a){return!!(c||a)},!1)},_box=function(b){return Array.isArray(b)?b:[b]},_toDate=function(b){return new Date(b)},_dtFieldToDate=function(b){return"[object String]"===Object.prototype.toString.call(b)?_toDate($$.getElement(b)):b},_where=function(c){var a=c.replace(/{{/g,"\\'\\'' + {{").replace(/}}/g," + '\\'\\' {{").replace(/{#/g,"' + {{").replace(/#}/g," + ' {{").split("{{");return"'"+a.reduce(function(c,a){return c+a},"")+"'"},_exists=function(b){return void 0!==b&&null!==b||!!b},_fromNullable=function(b){return void 0===b||!b},_isDateTimeField=function(b){return"DT"===$("#"+b).attr("type_code")||"D"===$("#"+b).attr("type_code")},_tryCatch=function(b){try{return b}catch(b){}},_isBlankDtTm=function(b){return""===getFormElement(b)&&""===getFormElement("time_"+b)},_isBlankDtOrTm=function(b){return""===getFormElement(b)||""===getFormElement("time_"+b)},_hasDtOrTm=_not(_isBlankDtTm),_isBlank=function(b){return _isDateTimeField(b)?_isBlankDtTm(b):""===getFormElement(b)},_hasValue=function(b){return _isDateTimeField(b)?_not(_isBlankDtOrTm)(b):_not(_isBlank)(b)},_wasModified=function(d){var a=$("#"+d).attr("old_value"),b=$$.getElement(d);return _exists(a)||$("#"+d).attr("old_value",""),!!_hasValue(d)&&_exists(a)&&a!==b},_keepValue=function(c){var a=$$.getElement(c);_hasValue(c)&&$("#"+c).attr("old_value",a)},_valueChanged=function(b){return _wasModified(b)&&_fromNullable(_keepValue(b))};return Global.$$={hasActiveEnrollment:function(peopleId,programId){var cond=eval(_where("program_info_id = {{programId}}")),has_enrollment=getDataValue("current_program_enrollment_view","people_id",peopleId,"program_name",cond),end_date=getDataValue("current_program_enrollment_view","people_id",peopleId,"end_date",cond);return has_enrollment&&!end_date},setXMLAttribute:function(e,f,b){e=_box(e).slice(),"number"==typeof b&&(b=b?"true":"false");for(var g=0;g<e.length;g++)_tryCatch($$.getNodeFromXML(e[g],formXML).setAttribute(f,b));refreshView(e[0])},getXMLAttribute:function(c,a){return _tryCatch($$.getNodeFromXML(c,formXML).getAttribute(a))},setRequired:function(d,e){d=_box(d).slice();var b=e?makeRequired:makeUnRequired;d.map(function(c){return _tryCatch(b({id:c}))})},setRequiredIfEntered:function(b){$$.setRequired(b,!_isBlank(b)),_isDateTimeField(b)&&$("#time_"+b).prev().attr("style",$("#caption_"+b).attr("style"))},setElement:function(h,a){if(formElementExists(h)){var b=$$.getNodeFromXML(h,formXML),c="true"===b.getAttribute("is_modifiable");if(b.setAttribute("is_modifiable","true"),_isDateTimeField(h)){var d=a.split(/\s/i),e=d[0],f=(d[1]?d[1]:"")+(d[2]?d[2]:"");_tryCatch(setFormElement(h,e)),_tryCatch(setFormElement("time_"+h,f)),c&&$("#time_"+h).attr("disabled",!c)}else _tryCatch(setFormElement(h,a));c&&$("#"+h).attr("disabled",!c)}},getElement:function(d,a){var b=_fromNullable(a)?getElementFromXML(formXML,d):getFormElement(d);return _isDateTimeField(d)&&16>=b.length&&(b=$("#"+d).val()+" "+$("#time_"+d).val()),b},getClientAge:function(b){return getDataValue("client_personal_view","people_id",b,"age")},getNodeFromXML:function(d,a){a=_fromNullable(a)?formXML:a;var e=null;return e="#"===d.charAt(0)?a.selectSingleNode("form_object/form_group/form_item[@caption='"+d.slice(1)+"']")||a.selectSingleNode("form_group/form_item[@caption='"+d.slice(1)+"']"):a.selectSingleNode("form_object/form_group/form_item[@column_name='"+d+"']")||a.selectSingleNode("form_group/form_item[@column_name='"+d+"']"),e},refreshView:function(b){xslTarget.innerHTML=transformXML(formXSL.XMLDocument.xml,formXML.xml),IsDirty()&&formState(b.form,!0)},showErrMsg:function(d,a){var e=$("#"+d)[0];$$.hideErrMsg(d),a="\u274C "+a,$(e).parent().parent().parent().prepend("<tr id=\""+e.id+"_err_row\"><td width=\"120\"></td><td rowSpan=\"1\" colSpan=\"1\"><div id="+e.id+"_err_msg >"+a+"</div></td></tr>"),$("#"+e.id+"_err_msg").css({margin:"10px 0px",padding:"10px",float:"left",width:"50%",color:"#D8000C",backgroundColor:"#FFD2D2",fontFamily:"arial",fontSize:".8em",verticalAlign:"middle"})},hideErrMsg:function(b){$("#"+b+"_err_row").remove()},dtComp:function(d,e,b){return d=_dtFieldToDate(d),b=_dtFieldToDate(b),"="===e?d.toString()===b.toString():"equal"===e?d.toString()===b.toString():"!="===e?d.toString()!==b.toString():"different"===e?d.toString()!==b.toString():">"===e?d>b:"after"===e?d>b:">="===e?d>=b:"<"===e?d<b:"before"===e?d<b:"<="==e&&d<=b},dateIsAfter:function(d,a,b){_hasValue(d)&&_valueChanged(d)&&!$$.dtComp(d,"after",a)?($$.showErrMsg(d,b),_hasValue(d)&&$$.setElement(d,"")):_hasValue(d)&&$$.dtComp(d,"after",a)&&$$.hideErrMsg(d)},dateIsBefore:function(d,a,b){_hasValue(d)&&_valueChanged(d)&&!$$.dtComp(d,"before",a)?($$.showErrMsg(d,b),!_isBlankDtTm(d)&&$$.setElement(d,"")):!_isBlankDtTm(d)&&$$.hideErrMsg(d)},allDt:function(d){var j="",a=d.reduce(function(b,a){var c=[].concat(_toConsumableArray(a)),d=c[0],e=c[1],f=c[2],g=c[3],h=$$.dtComp(d,e,f);return h||(j+=g+"\n",$$.setElement(d,"")),b&&h},!0);return a||alert(j),a},isAtMostHoursAfter:function(f,g,b,h){f=_dtFieldToDate(f),b=_dtFieldToDate(b);var d=(b-f)/60/60/1e3;d>g&&(alert(h),$$.setElement(f,""))},eraseOnDisable:function(currEl,eraseList){eraseList=_box(eraseList),eraseList.map(function(el){_tryCatch(eval($$.getXMLAttribute(el,"disable_rule_code")))&&(_tryCatch(setFormElement(el,"")),$("#"+el+"_prompt").val(""))})},getFormElement:function(c){function a(){return c.apply(this,arguments)}return a.toString=function(){return c.toString()},a}(function(b){return getFormElement(b).replace(/[{}]/g,"")}),copyEvents:function(d,a,b){b=_box(b),b.forEach(function(b){var c=d[b];c&&(a[b]=function(){c.call(this)})})},syncDtTmEvents:function(b){b=_box(b),b.map(function(b){return $$.copyEvents(document.getElementById(b),document.getElementById("time_"+b),["onchange","onblur"])})},hideFormField:function(b){_tryCatch(getFormElementDOM(b).style.display="none"),_tryCatch(getFormElementDOM("caption_"+b).style.display="none"),formState(formXML,!1)}},$$})(window.parent,document);